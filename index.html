<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Monitoring Device - Real-time Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Animated background -->
    <div class="ocean-background">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        
        <div class="bubble bubble1"></div>
        <div class="bubble bubble2"></div>
        <div class="bubble bubble3"></div>
        <div class="bubble bubble4"></div>
        <div class="bubble bubble5"></div>
        <div class="bubble bubble6"></div>
        <div class="bubble bubble7"></div>
        <div class="bubble bubble8"></div>
        
        <div class="fish fish1">üêü</div>
        <div class="fish fish2">üê†</div>
        <div class="fish fish3">ü¶ë</div>
        <div class="seaweed seaweed1"></div>
        <div class="seaweed seaweed2"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <img src="logo.png" alt="SafePond Logo" class="logo">
            </div>
            <div class="header-content">
                <h1 class="title">SafePond AI</h1>
                <p class="subtitle">Real-time Water Quality Monitoring System</p>
            </div>
            <div class="status-indicator">
                <div class="status-dot" id="connectionStatus"></div>
                <span id="statusText">Initializing...</span>
            </div>
            <a href="contributors.html" class="contributors-link">Contributors</a>
        </header>

        <!-- Main Dashboard Grid -->
        <main class="dashboard">
            <!-- Parameter Cards -->
            <div class="parameters-grid">
                <!-- Water Level -->
                <div class="parameter-card card-water">
                    <div class="card-header">
                        <h2 class="parameter-title">Water Level</h2>
                    </div>
                    <div class="card-body">
                        <div class="gauge-container">
                            <svg class="gauge" viewBox="0 0 200 200">
                                <circle cx="100" cy="100" r="90" class="gauge-background"/>
                                <circle cx="100" cy="100" r="90" class="gauge-progress" id="waterLevelGauge"/>
                                <text x="100" y="100" class="gauge-text" id="waterLevelText">0%</text>
                            </svg>
                        </div>
                        <div class="parameter-status">
                            <p class="status-label">Percentage</p>
                        </div>
                    </div>
                </div>

                <!-- TDS -->
                <div class="parameter-card card-tds">
                    <div class="card-header">
                        <h2 class="parameter-title">TDS</h2>
                    </div>
                    <div class="card-body">
                        <div class="value-display">
                            <span class="value" id="tdsValue">0</span>
                            <span class="unit">ppm</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="tdsProgress"></div>
                        </div>
                        <p class="status-label">Total Dissolved Solids</p>
                    </div>
                </div>

                <!-- Turbidity -->
                <div class="parameter-card card-turbidity">
                    <div class="card-header">
                        <h2 class="parameter-title">Turbidity</h2>
                    </div>
                    <div class="card-body">
                        <div class="value-display">
                            <span class="value" id="turbidityValue">0</span>
                            <span class="unit">NTU</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="turbidityProgress"></div>
                        </div>
                        <p class="status-label">Nephelometric Turbidity</p>
                    </div>
                </div>

                <!-- Temperature -->
                <div class="parameter-card card-temperature">
                    <div class="card-header">
                        <h2 class="parameter-title">Temperature</h2>
                    </div>
                    <div class="card-body">
                        <div class="value-display">
                            <span class="value" id="temperatureValue">0</span>
                            <span class="unit">¬∞C</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="temperatureProgress"></div>
                        </div>
                        <p class="status-label">Water Temperature</p>
                    </div>
                </div>

                <!-- pH Level -->
                <div class="parameter-card card-ph">
                    <div class="card-header">
                        <h2 class="parameter-title">pH Level</h2>
                    </div>
                    <div class="card-body">
                        <div class="value-display">
                            <span class="value" id="phValue">0</span>
                            <span class="unit">pH</span>
                        </div>
                        <div class="ph-scale">
                            <div class="ph-bar" id="phBar"></div>
                        </div>
                        <p class="status-label" id="phStatus">Neutral</p>
                    </div>
                </div>

                <!-- WQI -->
                <div class="parameter-card card-wqi">
                    <div class="card-header">
                        <h2 class="parameter-title">Water Quality Index</h2>
                    </div>
                    <div class="card-body">
                        <div class="wqi-display">
                            <svg class="wqi-circle" viewBox="0 0 120 120">
                                <circle cx="60" cy="60" r="50" class="wqi-background"/>
                                <circle cx="60" cy="60" r="50" class="wqi-fill" id="wqiFill"/>
                                <text x="60" y="70" class="wqi-text" id="wqiValue">0</text>
                            </svg>
                        </div>
                        <p class="status-label">Water Quality Index</p>
                    </div>
                </div>
            </div>
            <div class="wqi-status-box" id="wqiStatusBox">
                <h2 id="wqiStatusText">Water Quality Status</h2>
            </div>


            <!-- Suggestion Card -->
            <div class="suggestion-card">
                <div class="suggestion-header">
                    <h3>Suggestions & Recommendations</h3>
                </div>
                <div class="suggestion-body">
                    <p id="suggestionText">Initializing system...</p>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Last Updated: <span id="lastUpdate">--:--:--</span></p>
            <p>Device ID: ESP32_WATER_01</p>
            <p>&copy; SafePond_Ai | Developed by Mahmudul Hasan Piash & Faharia  Akter</p>
        </footer>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <script>
        console.log('üåä SafePond AI - Firebase REST API Version');

        // Firebase Configuration
        const firebaseConfig = {
            projectId: "sensor-reading-baea8",
            databaseURL: "https://sensor-reading-baea8-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        // Sensor Data
        const sensorData = {
            water_level: 0,
            tds: 0,
            turbidity: 0,
            temperature: 0,
            ph: 0,
            wqi: 0
        };

        let firebaseAvailable = false;

        // ====== Initialize ====== //
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Dashboard loaded');
            updateClock();
            setInterval(updateClock, 1000);
            
            // Try to fetch from Firebase
            fetchFromFirebase();
            
            // Also try periodic fetches
            setInterval(fetchFromFirebase, 3000);
        });

        // ====== Fetch Data from Firebase REST API ====== //
        function fetchFromFirebase() {
            const url = `${firebaseConfig.databaseURL}/sensors.json`;
            
            console.log('üì° Attempting to fetch from Firebase:', url);

            fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('‚úÖ Firebase data received:', data);
                
                if (data) {
                    // Update sensor data
                    sensorData.water_level = data.water_level ?? sensorData.water_level;
                    sensorData.tds = data.tds ?? sensorData.tds;
                    sensorData.turbidity = data.turbidity ?? sensorData.turbidity;
                    sensorData.temperature = data.temperature ?? sensorData.temperature;
                    sensorData.ph = data.ph ?? sensorData.ph;
                    sensorData.wqi = data.wqi ?? calculateWQI(data);

                    firebaseAvailable = true;
                    updateAllDisplays();
                    setConnectionStatus(true, 'Connected to Firebase');
                    updateFirebaseStatus(true, 'Connected to Firebase REST API');
                    
                    console.log('üìä Data updated from Firebase');
                } else {
                    console.log('‚ö†Ô∏è No data in Firebase yet');
                    updateFirebaseStatus(false, '‚ö†Ô∏è No data available (ESP32 may not have sent anything)');
                }
            })
            .catch(error => {
                console.error('‚ùå Firebase fetch error:', error);
                
                if (!firebaseAvailable) {
                    console.log('üìå Firebase unavailable, using simulated data');
                    if (sensorData.water_level === 0) {
                        // Initialize with default data
                        sensorData.water_level = 50;
                        sensorData.tds = 200;
                        sensorData.turbidity = 120;
                        sensorData.temperature = 25.5;
                        sensorData.ph = 7.2;
                        updateAllDisplays();
                    }
                    updateFirebaseStatus(false, '‚ùå Firebase unavailable - Using simulated data');
                    setConnectionStatus(true, 'SIMULATION MODE');
                    simulateData();
                }
            });
        }

        // ====== Simulate Data Changes ====== //
        function simulateData() {
            sensorData.water_level += (Math.random() - 0.5) * 3;
            sensorData.tds += (Math.random() - 0.5) * 8;
            sensorData.turbidity += (Math.random() - 0.5) * 5;
            sensorData.temperature += (Math.random() - 0.5) * 0.15;
            sensorData.ph += (Math.random() - 0.5) * 0.08;

            // Constrain values
            sensorData.water_level = Math.max(20, Math.min(85, sensorData.water_level));
            sensorData.tds = Math.max(150, Math.min(500, sensorData.tds));
            sensorData.turbidity = Math.max(80, Math.min(300, sensorData.turbidity));
            sensorData.temperature = Math.max(15, Math.min(35, sensorData.temperature));
            sensorData.ph = Math.max(6.0, Math.min(8.5, sensorData.ph));

            updateAllDisplays();
        }

        // ====== Update All Displays ====== //
        function updateAllDisplays() {
            updateWaterLevel();
            updateTDS();
            updateTurbidity();
            updateTemperature();
            updatePH();
            updateWQI();
            generateSuggestions();
        }

        // ====== Water Level ====== //
        function updateWaterLevel() {
            const value = sensorData.water_level;
            const circumference = 2 * Math.PI * 90;
            const offset = circumference * (1 - value / 100);

            const element = document.getElementById('waterLevelText');
            if (element) element.textContent = `${Math.round(value)}%`;
            
            const gauge = document.getElementById('waterLevelGauge');
            if (gauge) gauge.style.strokeDashoffset = offset;
        }

        // ====== TDS ====== //
        function updateTDS() {
            const value = sensorData.tds;
            const percentage = Math.min((value / 1000) * 100, 100);

            const element = document.getElementById('tdsValue');
            if (element) element.textContent = Math.round(value);
            
            const progress = document.getElementById('tdsProgress');
            if (progress) progress.style.width = percentage + '%';
        }

        // ====== Turbidity ====== //
        function updateTurbidity() {
            const value = sensorData.turbidity;
            const percentage = Math.min((value / 100) * 100, 100);

            const element = document.getElementById('turbidityValue');
            if (element) element.textContent = Math.round(value);
            
            const progress = document.getElementById('turbidityProgress');
            if (progress) progress.style.width = percentage + '%';
        }

        // ====== Temperature ====== //
        function updateTemperature() {
            const value = sensorData.temperature;
            const percentage = Math.min(((value + 10) / 40) * 100, 100);

            const element = document.getElementById('temperatureValue');
            if (element) element.textContent = value.toFixed(1);
            
            const progress = document.getElementById('temperatureProgress');
            if (progress) progress.style.width = percentage + '%';
        }

        // ====== pH ====== //
        function updatePH() {
            const value = sensorData.ph;
            const phPercentage = (value / 14) * 100;

            const element = document.getElementById('phValue');
            if (element) element.textContent = value.toFixed(1);
            
            const bar = document.getElementById('phBar');
            if (bar) bar.style.width = phPercentage + '%';

            let phStatus = 'Neutral';
            if (value < 5) phStatus = 'üî¥ Very Acidic';
            else if (value < 6) phStatus = 'üü† Acidic';
            else if (value < 7) phStatus = 'üü° Slightly Acidic';
            else if (value === 7) phStatus = 'üü¢ Neutral';
            else if (value < 8) phStatus = 'üü° Slightly Basic';
            else if (value < 9) phStatus = 'üü† Basic';
            else phStatus = 'üî¥ Very Basic';

            const statusElement = document.getElementById('phStatus');
            if (statusElement) statusElement.textContent = phStatus;
        }

        // ====== WQI ====== //
        function updateWQI() {
            const value = sensorData.wqi;
            const circumference = 2 * Math.PI * 50;
            const offset = circumference * (1 - value / 100);

            const element = document.getElementById('wqiValue');
            if (element) element.textContent = Math.round(value);
            
            const fill = document.getElementById('wqiFill');
            if (fill) fill.style.strokeDashoffset = offset;
        }

        // ====== Calculate WQI ====== //
        // function calculateWQI(data) {
        //     const tdsScore = Math.max(0, 100 - (data.tds ?? 0) / 10);
        //     function getTurbidityScore(turbidity) {
        //     if (turbidity === 0) {
        //         return 100;
        //     } else if (turbidity >= 1 && turbidity <= 25) {
        //         // 1‚Äì25 ‚Üí 99‚Äì55 (reverse of 1‚Äì55)
        //         return Math.round(100 - ((turbidity / 25) * 45));
        //     } else if (turbidity >= 26 && turbidity <= 51) {
        //         // 26‚Äì51 ‚Üí 54‚Äì20 (reverse of 56‚Äì80)
        //         return Math.round(80 - ((turbidity - 26) / 25) * 34);
        //     } else if (turbidity >= 52 && turbidity <= 100) {
        //         // 52‚Äì100 ‚Üí 19‚Äì0 (reverse of 80‚Äì100)
        //         return Math.round(20 - ((turbidity - 52) / 48) * 20);
        //     } else {
        //         return 0; // fallback
        //     }
        //     }

        //     // usage
        //     const turbidityScore = getTurbidityScore(data.turbidity);


            
        //     const ph = data.ph ?? 7;
        //     let phScore = 100;
        //     if (ph < 6.5 || ph > 8.5) {
        //         phScore = Math.max(0, 100 - Math.abs(ph - 7) * 10);
        //     }
            
        //     const temp = data.temperature ?? 25;
        //     let tempScore = 100;
        //     if (temp < 10 || temp > 35) {
        //         tempScore = Math.max(0, 100 - Math.abs(temp - 25) / 0.5);
        //     }

        //     return Math.max(0, Math.min(100, tdsScore * 0.3 + turbidityScore * 0.3 + phScore * 0.3 + tempScore * 0.1));
        // }
            function calculateWQI(data) {
            // Input validation with defaults
            const ph = data.ph ?? 7.0;
            const tds = data.tds ?? data.tds_ppm ?? 250;
            const temperature = data.temperature ?? data.temperature_c ?? 22;
            const turbidity = data.turbidity ?? data.turbidity_NTU ?? 25;
            const waterLevel = data.waterLevel ?? data.water_level_percentage ?? 90;

            // ========================================================================
            // 1. TURBIDITY SCORE (0-100) - Weight: 35%
            // Range: 0-51 NTU (0-100 scale, inverse relationship)
            // ========================================================================
            function getTurbidityScore(ntu) {
                if (ntu <= 0.5) {
                    return 100; // Excellent clarity
                } else if (ntu >= 0.5 && ntu <= 25) {
                    // 0.5-25 NTU ‚Üí 100-60 (linear decline)
                    // Excellent to Good range
                    return Math.max(60, Math.round(100 - ((ntu - 0.5) / 24.5) * 40));
                } else if (ntu > 25 && ntu <= 50) {
                    // 25-50 NTU ‚Üí 60-20 (linear decline)
                    // Fair to Poor range
                    return Math.max(20, Math.round(60 - ((ntu - 25) / 25) * 40));
                } else {
                    // > 50 NTU: Very turbid
                    return 0;
                }
            }

            const turbidityScore = getTurbidityScore(turbidity);

            // ========================================================================
            // 2. TDS (Total Dissolved Solids) SCORE (0-100) - Weight: 30%
            // Range: 10-600 ppm
            // Optimal: 50-250 ppm
            // ========================================================================
            function getTDSScore(tdsValue) {
                // Optimal range for drinking water: 50-150 ppm
                if (tdsValue <= 50) {
                    return 90; // Very pure (nearly distilled)
                } else if (tdsValue <= 150) {
                    return 100; // Excellent (optimal range)
                } else if (tdsValue <= 300) {
                    // 150-300: Good range
                    return Math.round(100 - ((tdsValue - 150) / 150) * 20);
                } else if (tdsValue <= 450) {
                    // 300-450: Fair range
                    return Math.round(80 - ((tdsValue - 300) / 150) * 35);
                } else if (tdsValue < 600) {
                    // 450-600: Poor range
                    return Math.round(45 - ((tdsValue - 450) / 150) * 40);
                } else {
                    return 5; // Extremely high salinity
                }
            }

            const tdsScore = getTDSScore(tds);

            // ========================================================================
            // 3. pH SCORE (0-100) - Weight: 20%
            // Optimal pH: 6.5-8.5 (neutral to slightly basic)
            // ========================================================================
            function getPhScore(phValue) {
                // Optimal range: 6.5-8.5
                if (phValue >= 6.5 && phValue <= 8.5) {
                    return 100; // Perfect pH range
                } else if (phValue >= 6.0 && phValue < 6.5) {
                    // Slightly acidic but acceptable
                    return Math.round(100 - (6.5 - phValue) * 20);
                } else if (phValue > 8.5 && phValue <= 9.0) {
                    // Slightly basic but acceptable
                    return Math.round(100 - (phValue - 8.5) * 20);
                } else if (phValue >= 5.5 && phValue < 6.0) {
                    // Acidic
                    return Math.round(60 - (6.0 - phValue) * 40);
                } else if (phValue > 9.0 && phValue <= 9.5) {
                    // Basic
                    return Math.round(60 - (phValue - 9.0) * 40);
                } else {
                    // Extreme pH (< 5.5 or > 9.5)
                    return Math.max(0, 20 - Math.abs(phValue - 7) * 5);
                }
            }

            const phScore = getPhScore(ph);

            // ========================================================================
            // 4. TEMPERATURE SCORE (0-100) - Weight: 15%
            // Optimal temperature: 15-25¬∞C
            // ========================================================================
            function getTemperatureScore(temp) {
                // Optimal range: 15-25¬∞C for most aquatic life
                if (temp >= 15 && temp <= 25) {
                    return 100; // Perfect temperature range
                } else if (temp >= 10 && temp < 15) {
                    // Cool but acceptable
                    return Math.round(100 - (15 - temp) * 10);
                } else if (temp > 25 && temp <= 30) {
                    // Warm but acceptable
                    return Math.round(100 - (temp - 25) * 12);
                } else if (temp >= 5 && temp < 10) {
                    // Cold
                    return Math.round(60 - (10 - temp) * 15);
                } else if (temp > 30 && temp <= 35) {
                    // Very warm
                    return Math.round(60 - (temp - 30) * 12);
                } else {
                    // Extreme temperature
                    return Math.max(0, 20 - Math.abs(temp - 22) * 2);
                }
            }

            const temperatureScore = getTemperatureScore(temperature);

            // ========================================================================
            // 5. FINAL WQI CALCULATION
            // Weighted formula based on parameter importance
            // ========================================================================
            const wqi = Math.max(
                0,
                Math.min(
                    100,
                    turbidityScore * 0.35 +    // 35% weight
                    tdsScore * 0.30 +           // 30% weight
                    phScore * 0.20 +            // 20% weight
                    temperatureScore * 0.15     // 15% weight
                )
            );

            // Round to 2 decimal places
            return Math.round(wqi * 100) / 100;
        }

        /**
         * HELPER FUNCTION: Get WQI Classification
         * Returns the water quality class based on calculated WQI value
         */
        function getWQIClass(wqi) {
            if (wqi >= 85) {
                return 'Excellent';
            } else if (wqi >= 70) {
                return 'Good';
            } else if (wqi >= 50) {
                return 'Fair';
            } else {
                return 'Poor';
            }
        }

        /**
         * HELPER FUNCTION: Get WQI Details with explanation
         * Returns detailed breakdown of WQI calculation
         */
        function getWQIDetails(data) {
            const ph = data.ph ?? 7.0;
            const tds = data.tds ?? data.tds_ppm ?? 250;
            const temperature = data.temperature ?? data.temperature_c ?? 22;
            const turbidity = data.turbidity ?? data.turbidity_NTU ?? 25;

            // Calculate individual scores (using the functions from calculateWQI)
            function getTurbidityScore(ntu) {
                if (ntu <= 0.5) return 100;
                else if (ntu >= 0.5 && ntu <= 25) {
                    return Math.max(60, Math.round(100 - ((ntu - 0.5) / 24.5) * 40));
                } else if (ntu > 25 && ntu <= 50) {
                    return Math.max(20, Math.round(60 - ((ntu - 25) / 25) * 40));
                } else return 0;
            }

            function getTDSScore(tdsValue) {
                if (tdsValue <= 50) return 90;
                else if (tdsValue <= 150) return 100;
                else if (tdsValue <= 300) {
                    return Math.round(100 - ((tdsValue - 150) / 150) * 20);
                } else if (tdsValue <= 450) {
                    return Math.round(80 - ((tdsValue - 300) / 150) * 35);
                } else if (tdsValue < 600) {
                    return Math.round(45 - ((tdsValue - 450) / 150) * 40);
                } else return 5;
            }

            function getPhScore(phValue) {
                if (phValue >= 6.5 && phValue <= 8.5) return 100;
                else if (phValue >= 6.0 && phValue < 6.5) {
                    return Math.round(100 - (6.5 - phValue) * 20);
                } else if (phValue > 8.5 && phValue <= 9.0) {
                    return Math.round(100 - (phValue - 8.5) * 20);
                } else if (phValue >= 5.5 && phValue < 6.0) {
                    return Math.round(60 - (6.0 - phValue) * 40);
                } else if (phValue > 9.0 && phValue <= 9.5) {
                    return Math.round(60 - (phValue - 9.0) * 40);
                } else {
                    return Math.max(0, 20 - Math.abs(phValue - 7) * 5);
                }
            }

            function getTemperatureScore(temp) {
                if (temp >= 15 && temp <= 25) return 100;
                else if (temp >= 10 && temp < 15) {
                    return Math.round(100 - (15 - temp) * 10);
                } else if (temp > 25 && temp <= 30) {
                    return Math.round(100 - (temp - 25) * 12);
                } else if (temp >= 5 && temp < 10) {
                    return Math.round(60 - (10 - temp) * 15);
                } else if (temp > 30 && temp <= 35) {
                    return Math.round(60 - (temp - 30) * 12);
                } else {
                    return Math.max(0, 20 - Math.abs(temp - 22) * 2);
                }
            }

            const turbidityScore = getTurbidityScore(turbidity);
            const tdsScore = getTDSScore(tds);
            const phScore = getPhScore(ph);
            const temperatureScore = getTemperatureScore(temperature);

            const wqi = Math.max(
                0,
                Math.min(
                    100,
                    turbidityScore * 0.35 + tdsScore * 0.30 + phScore * 0.20 + temperatureScore * 0.15
                )
            );

            return {
                wqi: Math.round(wqi * 100) / 100,
                wqiClass: getWQIClass(Math.round(wqi * 100) / 100),
                scores: {
                    turbidity: turbidityScore,
                    tds: tdsScore,
                    ph: phScore,
                    temperature: temperatureScore
                },
                weights: {
                    turbidity: '35%',
                    tds: '30%',
                    ph: '20%',
                    temperature: '15%'
                }
            };
        }

        // ====== Suggestions ====== //
        
        function generateSuggestions() {
            let suggestions = [];
            // Update large WQI box
            const statusBox = document.getElementById('wqiStatusBox');
            const statusText = document.getElementById('wqiStatusText');

            // Remove old classes
            statusBox.classList.remove('wqi-poor', 'wqi-fair', 'wqi-good', 'wqi-excellent');

            if (sensorData.wqi <= 40) {
                statusText.textContent = 'Water Quality: POOR';
                statusBox.classList.add('wqi-poor');
            }
            else if (sensorData.wqi <= 60) {
                statusText.textContent = 'Water Quality: FAIR';
                statusBox.classList.add('wqi-fair');
            }
            else if (sensorData.wqi <= 80) {
                statusText.textContent = 'Water Quality: GOOD';
                statusBox.classList.add('wqi-good');
            }
            else {
                statusText.textContent = 'Water Quality: EXCELLENT';
                statusBox.classList.add('wqi-excellent');
            }


            // Water level
            if (sensorData.water_level < 30) suggestions.push('‚ö†Ô∏è Water level is low.');
            else if (sensorData.water_level > 80) suggestions.push('‚ö†Ô∏è Water level is high.');
            else suggestions.push('‚úÖ Water level is optimal.');

            // TDS
            if (sensorData.tds > 500) suggestions.push('üî¥ High TDS.');
            else if (sensorData.tds > 300) suggestions.push('üü° TDS is moderately high.');
            else suggestions.push('‚úÖ TDS is healthy.');

            // Turbidity
            if (sensorData.turbidity > 50) suggestions.push('üî¥ High turbidity.');
            else if (sensorData.turbidity > 26) suggestions.push('üü° Turbidity is elevated.');
            else if (sensorData.turbidity > 1) suggestions.push('üü° Turbidity is acceptable.');
            else suggestions.push('‚úÖ Water clarity is excellent.');

            // pH
            const ph = sensorData.ph;
            if (ph < 6.5 || ph > 8.5) suggestions.push(`‚ö†Ô∏è pH (${ph.toFixed(1)}) out of range.`);
            else suggestions.push(`‚úÖ pH (${ph.toFixed(1)}) is optimal.`);

            // Temperature
            if (sensorData.temperature < 15) suggestions.push('‚ùÑÔ∏è Temperature is cold.');
            else if (sensorData.temperature > 32) suggestions.push('üî• Temperature is high.');
            else suggestions.push('‚úÖ Temperature is ideal.');

            // ====== WQI CLASSIFICATION ====== //
            sensorData.wqi = calculateWQI(sensorData);

            if (sensorData.wqi <= 40) {
                suggestions.push('üî¥ Water Quality: Poor (0‚Äì40).');
            }
            else if (sensorData.wqi <= 60) {
                suggestions.push('‚ö†Ô∏è Water Quality: Fair (41‚Äì60).');
            }
            else if (sensorData.wqi <= 80) {
                suggestions.push('üëç Water Quality: Good (61‚Äì80).');
            }
            else {
                suggestions.push('‚≠ê Water Quality: Excellent (81‚Äì100).');
            }

            const element = document.getElementById('suggestionText');
            if (element) element.textContent = suggestions.join(' | ');
        }


        // ====== Clock ====== //
        function updateClock() {
            const element = document.getElementById('lastUpdate');
            if (element) element.textContent = new Date().toLocaleTimeString();
        }
    </script>
</body>
</html>